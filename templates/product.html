{% extends 'base.html' %}


{% block title %}
<title>Product page</title>
{% endblock %}


{% block content %}
<div id="overlay" style="display: none;"></div>
<div class="write__wrapper card" style="display: none;">
    <h1>Write review</h1>
    <form action="" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <textarea required style="width: 100%;" name="text" cols="30" rows="4" class="default-textarea text-default" placeholder="Write your review"></textarea>
        <div class="write__wrapper__stars">
            <button class="write__wrapper__star" onclick="star_clicked(this)" type="button"><img src="/media/star.png" alt=""></button>
            <button class="write__wrapper__star" onclick="star_clicked(this)" type="button"><img src="/media/star.png" alt=""></button>
            <button class="write__wrapper__star" onclick="star_clicked(this)" type="button"><img src="/media/star.png" alt=""></button>
            <button class="write__wrapper__star" onclick="star_clicked(this)" type="button"><img src="/media/star.png" alt=""></button>
            <button class="write__wrapper__star" onclick="star_clicked(this)" type="button"><img src="/media/star.png" alt=""></button>
            <input value="5" type="number" name="stars" id="stars" hidden>
        </div>
        <input type="file" multiple name="images" id="images" class="default-input text-default" placeholder="Your images">
        <button type="submit" class="banner__right__btn text-default-white">Add review</button>
    </form>
</div>
<main>
    <div class="product card container">
        <div class="product__left">
            <div class="product__left__main-photo card">
                <div class="image-container2">
                    <img id="main_photo" src="{{ photo.0 }}" alt="" class="recommended__card__photo">
                    <div class="overlay"></div>
                    <div class="eye2" style='background: url("/media/eye.png") no-repeat center center / cover;'></div>
                </div>
            </div>
            <div class="product__left__bottom-photos">
                <button onclick="change_photo(this)" class="product__left__bottom-photo bottom-photos-active">
                    <img src="{{ photo.0 }}" alt="">
                </button>
                {% for p in photo|slice:"1:" %}
                <button onclick="change_photo(this)" class="product__left__bottom-photo bottom-photos">
                    <img src="{{ p }}" alt="">
                </button>
                {% endfor %}
            </div>
        </div>
        <div class="product__middle">
            <div class="product__middle__top">
                <p class="product__middle__top-price"><b>{{ product.name }}</b></p>
                <div class="shop__products__right__middle__bottom">
                    <div class="shop__product__top__left__stars">
                        {% for s in range %}
                        {% if s <= product.stars %}
                        <img src="/media/star.png" alt="">
                        {% else %}
                        <img src="/media/star2.png" alt="">
                        {% endif %}
                        {% endfor %}
                        <p class="text-default-18">{{ product.stars }}</p>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 6 6" fill="none">
                        <circle cx="3" cy="3" r="3" fill="#DEE2E7"></circle>
                    </svg>
                    <p class="product__middle__top-orders text-gray">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M3.33317 3.33329H16.6665V13.3333H4.30817L3.33317 14.3083V3.33329ZM3.33317 1.66663C2.4165 1.66663 1.67484 2.41663 1.67484 3.33329L1.6665 18.3333L4.99984 15H16.6665C17.5832 15 18.3332 14.25 18.3332 13.3333V3.33329C18.3332 2.41663 17.5832 1.66663 16.6665 1.66663H3.33317ZM4.99984 9.99996H14.9998V11.6666H4.99984V9.99996ZM4.99984 7.49996H14.9998V9.16663H4.99984V7.49996ZM4.99984 4.99996H14.9998V6.66663H4.99984V4.99996Z" fill="#8B96A5"/>
                        </svg>
                        {{ reviews|length }} reviews
                    </p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="6" height="6" viewBox="0 0 6 6" fill="none">
                        <circle cx="3" cy="3" r="3" fill="#DEE2E7"></circle>
                    </svg>
                    <p class="text-gray">154 orders</p>
                </div>
            </div>
            <div class="product__middle__bottom">
                <div class="product__middle__bottom-price">
                    <p class="text-default-18 text-muted">Price:</p>
                    <p class="text-default-18 shop__products__right__middle-price" style="font-size: 20px;"><b>${{ product.price }}</b><span class="text-gray">$2000.00</span></p>
                </div>
                <div class="product__middle__bottom-price">
                    <p class="text-default-18 text-muted">Category:</p>
                    <p class="text-default-18 text-gray" style="font-size: 18px;">{{ product.main_category }}</p>
                </div>
                <div class="product__middle__bottom-price">
                    <p class="text-default-18 text-muted">Brand:</p>
                    <p class="text-default-18 text-gray" style="font-size: 18px;">{{ product.brand }}</p>
                </div>
                <div class="product__middle__bottom-price">
                    <p class="text-default-18 text-muted">State:</p>
                    <p class="text-default-18 text-gray" style="font-size: 18px;">{{ product.state }}</p>
                </div>
                <div class="product__middle__bottom-price">
                    <p class="text-default-18 text-muted">Created:</p>
                    <p class="text-default-18 text-gray" style="font-size: 18px;">{{ product.create_at }}</p>
                </div>
                <div class="product__middle__bottom-other">
                    <p class="text-default-18 text-gray product__middle__bottom-other-text">Other:</p>
                    {% for c in categories %}
                    <div class="product__middle__bottom-other-item">
                        <p class="text-default-18 text-muted">{{ c.category }}:</p>
                        <p class="text-default-18 text-gray" style="font-size: 18px;">{{ c.name }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="product__right">
            <div class="product__right__top card">
                <div class="product__right__top__top">
                    <img src="/media/{{ product.supplier.photo }}" alt="">
                    <p class="text-default-18">Supplier<br>{{ product.supplier.user.username }}</p>
                </div>
                <div class="product__right__top__bottom">
                    <a href="{% url 'add_to_cart' product.slug %}" class="banner__right__btn text-default-white">Add to cart</a>
                    <a href="{% url 'account' product.supplier.user.username %}" class="banner__right__btn text-default-white">Seller's profile</a>
                </div>
            </div>
            {% if request.user.is_authenticated %}
            <a href="{% url 'save_product' product.id %}" class="text-default-primary product__right-save">
                <button class="shop__product__top__right{% if saved %}-active{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M16.5 2.82495C14.76 2.82495 13.09 3.63495 12 4.91495C10.91 3.63495 9.24 2.82495 7.5 2.82495C4.42 2.82495 2 5.24495 2 8.32495C2 12.105 5.4 15.185 10.55 19.865L12 21.175L13.45 19.855C18.6 15.185 22 12.105 22 8.32495C22 5.24495 19.58 2.82495 16.5 2.82495ZM12.1 18.375L12 18.475L11.9 18.375C7.14 14.065 4 11.215 4 8.32495C4 6.32495 5.5 4.82495 7.5 4.82495C9.04 4.82495 10.54 5.81495 11.07 7.18495H12.94C13.46 5.81495 14.96 4.82495 16.5 4.82495C18.5 4.82495 20 6.32495 20 8.32495C20 11.215 16.86 14.065 12.1 18.375Z" fill="#0D6EFD"/>
                    </svg>
                </button>
                Save for later
            </a>
            {% endif %}
        </div>
    </div>
    <div class="product__bottom container">
        <div class="product__bottom__left card">
            <div class="product__bottom__tabs">
                <button onclick="change_content(this, 1)" class="product__bottom__tab product__bottom__tab-active">Description</button>
                <button onclick="change_content(this, 2)" class="product__bottom__tab">Reviews</button>
                <div class="product__bottom__tabs-indicator"></div>
            </div>
            <div class="product__bottom__content-wrapper">
                <div class="product__bottom__content" id="content_1">
                    <p class="text-gray-18">{{ markdown_to_html | safe }}</p>
                </div>
                <div class="product__bottom__content" id="content_2" hidden>
                    <div class="product__bottom__reviews" style="position: relative; padding-top: 60px;">
                        <button id="write_review" class="banner__right__btn text-default-white">Write review</button>
                        {% for review in reviews %}
                        <div class="product__bottom__review card">
                            {% if review.images %}
                            <p class="text-default">Photos:</p>
                            <div class="product__bottom__review__photos">
                                {% for p in review.images %}
                                <div class="image-container5">
                                    <img id="main_photo" src="{{ p.image.url }}" alt="" class="recommended__card__photo">
                                    <div class="overlay"></div>
                                    <div class="eye3" style='background: url("/media/eye.png") no-repeat center center / cover;'></div>
                                </div>
                                {% endfor %}
                            </div>
                            <span class="product__bottom__review-devider"></span>
                            {% endif %}
                            <div class="product__bottom__review__user">
                                <img src="/media/{{ review.review.user.photo }}" class="product__bottom__review__logo" alt="">
                                <div class="product__bottom__review__user-content">
                                    <p class="text-default">{{ review.review.user }}</p>
                                    <div class="shop__product__top__left__stars">
                                        {% for s in range %}
                                        {% if s < review.review.stars %}
                                        <img src="/media/star.png" alt="">
                                        {% else %}
                                        <img src="/media/star2.png" alt="">
                                        {% endif %}
                                        {% endfor %}
                                        <p class="text-default">{{ review.review.stars }}</p>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray">{{ review.review.text }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% if not product in you_may_like_products %}
        <div class="product__bottom__right card">
            <p class="text-default2"><b>You may like</b></p>
            {% for item in you_may_like_products %}
            <a href="" class="product__bottom__right__product">
                <div class="product__bottom__right__product__image card">
                    <img src="/media/products/product_1.png" alt="">
                </div>
                <div class="product__bottom__right__product__text">
                    <p class="text-default">{{ item.name }}</p>
                    <p class="text-default text-muted">${{ item.price }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</main>
<script>
    let btn = document.querySelector('#write_review')
    let overlay = document.querySelector('#overlay')
    let content = document.querySelector('.write__wrapper')
    btn.addEventListener('click', function () {
        overlay.style.display = 'flex'
        content.style.display = 'flex'
    })
    overlay.addEventListener('click', function () {
        overlay.style.display = 'none'
        content.style.display = 'none'
    })
</script>
<script>
    const indicator = document.querySelector('.product__bottom__tabs-indicator');
    function change_content(btn, id) {
        document.querySelector('.product__bottom__tab-active').classList.remove('product__bottom__tab-active')
        btn.classList.add('product__bottom__tab-active')
        const tab = btn
        const offsetLeft = tab.offsetLeft - 8;
        const width = tab.clientWidth;
        indicator.style.transform = `translateX(${offsetLeft}px)`;
        indicator.style.width = `${width}px`;

        document.querySelectorAll('.product__bottom__content').forEach(function (i) {
            i.hidden = true;
        })
        document.querySelector(`#content_${id}`).hidden = false
    }
</script>
<script>
    images = document.querySelectorAll('.image-container5')
    images.forEach(function (i) {
        i.addEventListener('click', function(event) {
            event.preventDefault();
            document.getElementById('zoom-modal').style.display = 'block';
            let src
            if (event.target.classList[0] == 'eye3') {
                src = event.target.previousElementSibling.previousElementSibling
            } else {
                src = event.target.previousElementSibling
            }
            document.getElementById('zoom-modal').children[0].src = src.src
        });
    })
    document.getElementById('zoom-modal').addEventListener('click', function () {
        document.getElementById('zoom-modal').style.display = 'none';
    })
</script>
<script>
    document.querySelector('.image-container2').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('zoom-modal').style.display = 'block';
        let src
        if (event.target.classList[0] == 'eye2') {
            src = event.target.previousElementSibling.previousElementSibling
        } else {
            src = event.target.previousElementSibling
        }
        document.getElementById('zoom-modal').children[0].src = src.src
    });
    document.getElementById('zoom-modal').addEventListener('click', function () {
        document.getElementById('zoom-modal').style.display = 'none';
    })
</script>
<script>
    function change_photo(btn) {
        document.querySelector('.bottom-photos-active').classList.remove('bottom-photos-active');
        btn.classList.add('bottom-photos-active');
        document.querySelector('#main_photo').src = btn.children[0].src
    }
</script>
<script>
    function open_menu() {
        document.querySelector('.mobile-menu-wrapper').hidden = false;
    }
    document.querySelector('.mobile-menu-wrapper').addEventListener('click', function() {
        document.querySelector('.mobile-menu-wrapper').hidden = true;
    })
</script>
<script>
    let stars = document.querySelectorAll('.write__wrapper__star')
    let stars_input = document.querySelector('#stars')
    function star_clicked(btn) {
        stars.forEach(function(star) {
            star.children[0].src = '/media/star2.png'
        })
        btn.children[0].src = '/media/star.png'
        stars_input.value = 1
        for(let i = 0; i < stars.length; i++) {
            if (stars[i] != btn) {
                stars[i].children[0].src = '/media/star.png'
                stars_input.value = parseInt(stars_input.value) + 1
            } else {
                break
            }
        }
    }
</script>
{% endblock %}